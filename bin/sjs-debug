#!/usr/bin/env node-debug

var parser = require("../build/lib/parser");
var expander = require("../build/lib/expander");
var patterns = require("../build/lib/patterns");
var sweet = require("../build/lib/sweet");
var codegen = require("escodegen");

var fs = require("fs");

var program = require('commander');

program
  .version('0.0.1')
  .usage('<files>')

  .on('--help', function(){
    console.log('requires that you have built sweet.js');
    console.log('in the console/terminal run: grunt');
    console.log('which will build the files (will create a /build folder)');
    console.log('Then you can run: sjs-debug <files ...>');
    console.log('Enjoy :)');
  })
  .parse(process.argv);

var files = program.args;

// read src of all files and push src into list
var filesSrc = files.map(function(file) {
  return readFile(file));
})
// join all src codes in that order
var fullSrc = filesSrc.join('\n')

// compile concatenated src
compileMacro(fullSrc);

function readFile(file) {
  var filePath = "./" + file;
  return fs.readFileSync(filePath, "utf8");
}

function compileMacro(file) {
  var result = sweet.compile(source, {filename: filePath});
  console.log(codegen.generate(parser.parse(result.code)));
}
